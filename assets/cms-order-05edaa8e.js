import"./bootstrap-cc139003.js";import s from"https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.1/esm/axios.js";import{e as S,j as r,a as H,i as I,s as A}from"./config-e6f0afb8.js";$(function(){$.datepicker.regional["zh-TW"]={dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesMin:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],prevText:"上月",nextText:"次月",weekHeader:"週"},$.datepicker.setDefaults($.datepicker.regional["zh-TW"]),$(function(){$(".datepicker").datepicker({beforeShow:function(t,e){e.dpDiv.addClass("custom-datepicker")},dateFormat:"yy-mm-dd",minDate:1,maxDate:"+3M",onSelect:function(t,e){}}),$(".startDate").datepicker({beforeShow:function(t,e){e.dpDiv.addClass("custom-datepicker")},dateFormat:"yy-mm-dd",minDate:1,maxDate:"+3M",onSelect:function(t,e){const a=new Date(t),o=new Date($(".endDate").val());o&&(a>o?(S("入住日期不能大於退房日期！","請重新選擇日期"),$(".startDate").val("")):a.getDate()===o.getDate()&&a.getMonth()===o.getMonth()&&a.getFullYear()===o.getFullYear()&&(S("入住日期不能與退房日期相同！","請重新選擇日期"),$(".startDate").val("")))}}),$(".endDate").datepicker({beforeShow:function(t,e){e.dpDiv.addClass("custom-datepicker")},dateFormat:"yy-mm-dd",minDate:1,maxDate:"+3M",onSelect:function(t,e){const a=new Date(t),o=new Date($(".startDate").val());o&&(o>a?(S("退房日期不能小於入住日期！","請重新選擇日期"),$(".endDate").val("")):o.getDate()===a.getDate()&&o.getMonth()===a.getMonth()&&o.getFullYear()===a.getFullYear()&&(S("入住日期不能與退房日期相同！","請重新選擇日期"),$(".endDate").val("")))}})})});$(".startDate").on("change",function(t){const e=t.target.value;if(e){const a=new Date(e),o=new Date($(".endDate").val());o&&a>o?(S("入住日期不能大於退房日期！","請重新選擇日期"),$(".startDate").val("")):o&&a.getTime()===o.getTime()&&(S("入住日期不能與退房日期相同！","請重新選擇日期"),$(".startDate").val(""))}});$(".endDate").on("change",function(t){const e=t.target.value;if(e){const a=new Date(e),o=new Date($(".startDate").val());o&&o>a?(S("退房日期不能小於入住日期！","請重新選擇日期"),$(".endDate").val("")):o&&o.getTime()===a.getTime()&&(S("入住日期不能與退房日期相同！","請重新選擇日期"),$(".endDate").val(""))}});$(document).ready(function(){$(".timepicker").timepicker({timeFormat:"h:i A",step:60,minTime:"9:00",maxTime:"21:00",startTime:"9:00",dynamic:!0}),$(".timepicker").on("changeTime",function(){$(this).val()})});(function(){var t=document.querySelectorAll(".needs-validation");Array.prototype.slice.call(t).forEach(function(e){e.addEventListener("submit",function(a){e.checkValidity()||(a.preventDefault(),a.stopPropagation()),e.classList.add("was-validated")},!1)})})();const j=10;let p=1,i="allCase-tab";const z=document.querySelector(".js-blacklist"),N=document.querySelector(".js-cancelCaseContent"),T=document.querySelectorAll(".js-serviceSelect"),x=document.querySelector(".js-openCaseContent"),P=document.querySelector(".js-allCaseContent");let h;f("reverse","allCase");document.querySelectorAll(".nav-link").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),i=e.target.closest(".nav-link").getAttribute("id"),T.forEach(a=>{a.value="服務篩選"}),e.target.closest(".js-allCasePill")?f("reverse","allCase"):e.target.closest(".js-openCasePill")?f("reverse","openCase"):e.target.closest(".js-canacelPill")?f("cancelCases","cancelCase"):e.target.closest(".js-blacklistPill")&&f("blacklists","blacklist")})});const O=document.querySelector(".js-blackListNum");function R(){s.get(`${r}/blackLists`).then(t=>{let e=t.data;O.textContent=e.length}).catch(t=>{console.log(t)})}R();function f(t,e){p=1;const a=document.querySelector(`#${e}`),o=a.querySelector(".pagination"),c=t==="reverse";s.get(`${r}/${t}`).then(d=>{let C=d.data;c&&e==="openCase"&&(C=C.filter(l=>l.isChecked===!1)),v(C,a),k(C,a,o)}).catch(d=>{console.log(d)})}async function v(t,e){const a=(p-1)*j,o=a+j,c=t.sort((l,n)=>n.id-l.id).slice(a,o),d=t.sort((l,n)=>new Date(l.date)-new Date(n.date)).slice(a,o),C=t.sort((l,n)=>new Date(n.date)-new Date(l.date)).slice(a,o);if(e){if(e.classList.contains("blacklist")){let l="";c.forEach(n=>{l+=`
                    <tr>
                        <th scope="row" class="fw-normal">${n.name}</th>
                        <td>${n.email}</td>
                        <td>${n.phone}</td>
                        <td>${n.date}</td>
                        <td>${n.reason}</td>
                    </tr>`}),z.innerHTML=l}else if(e.classList.contains("cancelCase")){let l="";for(const n of c){const m=await b(n.userId);l+=`
                    <tr>
                        <th scope="row">
                            <a href="#" data-bs-toggle="modal"
                                data-bs-target="#cancelCaseModal" data-id=${n.id}>${n.orderNum}</a>
                        </th>
                        <td>${n.date}</td>
                        <td>${n.service}</td>
                        <td>${m.name}</td>
                        <td>${m.phone}</td>
                        <td>${n.dogName}</td>
                        <td>${n.paradise}</td>
                    </tr>
                        `}N.innerHTML=l}else if(e.classList.contains("openCase")){let l="";for(const n of d){const m=await b(n.userId);let u="";n.service==="安親"?u="dayCareModal":n.service==="美容"?u="cosmeticModal":n.service==="住宿"&&(u="stayModal"),l+=`
                    <tr>
                        <th scope="row">
                            <a href="#" class="js-serviceModal" data-bs-toggle="modal" data-bs-target="#${u}" data-id=${n.id}>${n.orderNum}</a>
                        </th>
                        <td>${n.date}</td>
                        <td>${n.service}</td>
                        <td>${m.name}</td>
                        <td>${m.phone}</td>
                        <td>${n.dogName}</td>
                        <td>${n.paradise}</td>
                        <td>
                            <div class="d-flex justify-content-center">
                                <input type="checkbox" class="checkbox w-18px h-18px" data-id=${n.id}>
                            </div>
                        </td>
                        <td><a href="#" data-bs-toggle="modal" data-bs-target="#cancelModal" class="link-black-60 js-cancelModal" data-id=${n.id}><i class="bi bi-trash3-fill fs-5"></i></a></td>
                    </tr>
                        `}x.innerHTML=l}else if(e.classList.contains("allCase")){let l="";for(const n of C){const m=await b(n.userId);let u="";n.service==="安親"?u="allCaseDayCareModal":n.service==="美容"?u="allCaseCosmeticModal":n.service==="住宿"&&(u="allCaseStayModal"),l+=`
                    <tr>
                        <th scope="row">
                            <a href="#" class="js-allCaseModal" data-bs-toggle="modal" data-bs-target="#${u}" data-id=${n.id}>${n.orderNum}</a>
                        </th>
                        <td>${n.date}</td>
                        <td>${n.service}</td>
                        <td>${m.name}</td>
                        <td>${m.phone}</td>
                        <td>${n.dogName}</td>
                        <td>${n.paradise}</td>
                        ${n.isChecked?'<td><i class="bi bi-check-lg fs-5"></i></td>':"<td>-</td>"}
                    </tr>
                    `}P.innerHTML=l}}}async function b(t){try{return(await s.get(`${r}/users`)).data.find(o=>o.id===parseInt(t))}catch(e){return console.log(e),null}}function k(t,e,a){const o=Math.ceil(t.length/j),c=a;c.innerHTML="";const d=(n,m)=>{const u=document.createElement("li");u.className="page-item";const q=document.createElement("a");return q.className="page-link",q.href="#",q.textContent=n,q.setAttribute("data-page",n),q.addEventListener("click",m),u.appendChild(q),u},C=d("<",()=>{p>1&&(p--,v(t,e),M(e))});c.appendChild(C);for(let n=1;n<=o;n++){const m=d(n,()=>{p=n,v(t,e),M(e)});c.appendChild(m)}const l=d(">",()=>{p<o&&(p++,v(t,e),M(e))});c.appendChild(l),M(e)}function M(t){document.querySelectorAll(".page-link").forEach(a=>a.classList.remove("active"));const e=t.querySelector(`.page-link[data-page="${p}"]`);e&&e.classList.add("active")}const y=document.querySelector(".blackForm"),V=document.querySelector(".js-blockName"),E=document.querySelector(".js-blockEmail"),L=document.querySelector(".js-blockPhone"),Y=document.querySelector(".js-blockDate"),U=document.querySelector(".js-blockReason");y.addEventListener("submit",W);function W(t){if(t.preventDefault(),y.checkValidity())if(H(E.value.trim()))if(I(L.value.trim()))s.post(`${r}/blackLists`,{name:V.value.trim(),email:E.value.trim(),phone:L.value.trim(),date:Y.value.trim(),reason:U.value.trim()}).then(e=>{A("新增成功!","",3e3),$("#blackListModal").modal("hide"),y.reset(),y.classList.remove("was-validated"),R(),f("blacklists","blacklist")}).catch(e=>{console.log(e)});else{y.querySelector(".js-errorPhone").innerHTML='<i class="bi bi-exclamation-circle me-4"></i> 手機號碼號碼格式錯誤',L.value="";return}else{y.querySelector(".js-errorEmail").innerHTML='<i class="bi bi-exclamation-circle me-4"></i> Email格式錯誤',E.value="";return}else{t.stopPropagation();return}}document.querySelectorAll(".btn-close").forEach(t=>{t.addEventListener("click",()=>{y.reset(),y.classList.remove("was-validated")})});document.querySelector(".js-clearFormBtn").addEventListener("click",()=>{y.reset(),y.classList.remove("was-validated")});const G=document.querySelector(".js-cancelCaseNum");function F(){s.get(`${r}/cancelCases`).then(t=>{let e=t.data;G.textContent=e.length}).catch(t=>{console.log(t)})}F();N.addEventListener("click",J);function J(t){if(t.target.getAttribute("data-bs-toggle")){t.preventDefault();let e=t.target.getAttribute("data-id");s.get(`${r}/cancelCases/${e}`).then(a=>{let o=a.data;K(o)}).catch(a=>{console.log(a)})}}const g=document.querySelector("#cancelCaseModal");async function K(t){try{const e=await b(t.userId);g.querySelector(".modalOrderNum").textContent=t.orderNum,g.querySelector(".modalDate").textContent=t.date,g.querySelector(".modalService").textContent=t.service,g.querySelector(".modalName").textContent=e.name,g.querySelector(".modalPhone").textContent=e.phone,g.querySelector(".modalDogName").textContent=t.dogName,g.querySelector(".modalParadise").textContent=t.paradise,g.querySelector(".modalRemark").textContent=t.remark,g.querySelector(".modalEmergencyContact").textContent=t.contact,g.querySelector(".modalEmergencyPhone").textContent=t.phone}catch(e){console.log(e)}}T.forEach(t=>{t.addEventListener("change",e=>{if(i==="allCase-tab")if(e.target.value==="")f("reverse","allCase");else{const a=e.target.value;w(a,"reverse")}else if(i==="openCase-tab")if(e.target.value==="")f("reverse","openCase");else{const a=e.target.value;w(a,"reverse")}else if(i==="cancelCase-tab")if(e.target.value==="")f("cancelCases","cancelCase");else{const a=e.target.value;w(a,"cancelCases")}})});function w(t,e){h=[],s.get(`${r}/${e}`).then(a=>{let o=a.data;p=1,t==="安親"?h=o.filter(c=>c.service==="安親"):t==="美容"?h=o.filter(c=>c.service==="美容"):t==="住宿"&&(h=o.filter(c=>c.service==="住宿")),i==="cancelCase-tab"?(v(h,document.querySelector(".cancelCase")),k(h,document.querySelector(".cancelCase"),document.querySelector(".cancelCase .pagination"))):i==="openCase-tab"?(v(h,document.querySelector(".openCase")),k(h,document.querySelector(".openCase"),document.querySelector(".openCase .pagination"))):i==="allCase-tab"&&(v(h,document.querySelector(".allCase")),k(h,document.querySelector(".allCase"),document.querySelector(".allCase .pagination")))}).catch(a=>{console.log(a)})}const Q=document.querySelector(".js-openCaseNum");function B(){s.get(`${r}/reverse`).then(t=>{let a=t.data.filter(o=>o.isChecked===!1);Q.textContent=a.length}).catch(t=>{console.log(t)})}B();x.addEventListener("change",ee);x.addEventListener("click",oe);x.addEventListener("click",ae);const X=document.querySelector("#dayCareModal"),Z=document.querySelector("#cosmeticModal"),_=document.querySelector("#stayModal");function ee(t){if(t.target.classList.contains("checkbox")){let e=t.target.getAttribute("data-id");s.get(`${r}/reverse/${e}`).then(a=>{let o=a.data;document.querySelector(".js-checkModalNum").textContent=o.orderNum,document.querySelector(".js-checkBtn").setAttribute("data-id",o.id),$("#checkModal").modal("show")}).catch(a=>{console.log(a)})}}document.querySelector(".js-checkBtn").addEventListener("click",async t=>{let e=t.target.getAttribute("data-id");try{let o=(await s.get(`${r}/reverse/${e}`)).data;o.isChecked=!0,await s.patch(`${r}/reverse/${e}`,o),A("已結案！","",3e3),f("reverse","openCase"),$("#checkModal").modal("hide")}catch(a){console.log(a)}});document.querySelector(".js-nocheckBtn").addEventListener("click",()=>{$("#checkModal").modal("hide"),document.querySelectorAll(".checkbox").forEach(t=>t.checked=!1)});const te=document.querySelector("#checkModal");te.addEventListener("click",t=>{t.target.classList.contains("btn-close")&&document.querySelectorAll(".checkbox").forEach(e=>e.checked=!1)});function ae(t){if(t.target.closest(".js-cancelModal")){t.preventDefault();let e=t.target.closest(".js-cancelModal").getAttribute("data-id");s.get(`${r}/reverse/${e}`).then(a=>{let o=a.data;document.querySelector(".js-cancelModalNum").textContent=o.orderNum,document.querySelector(".js-cancelBtn").setAttribute("data-id",o.id)}).catch(a=>{console.log(a)})}}document.querySelector(".js-cancelBtn").addEventListener("click",async t=>{let e=t.target.getAttribute("data-id");try{const o=(await s.get(`${r}/reverse/${e}`)).data,d=(await s.get(`${r}/cancelCases`)).data.length+1;o.id=d,await s.post(`${r}/cancelCases`,o),await s.delete(`${r}/reverse/${e}`),A("取消成功！","",3e3),f("reverse","openCase"),B(),F(),$("#cancelModal").modal("hide")}catch(a){console.log(a)}});document.querySelector(".js-noCancelBtn").addEventListener("click",()=>$("#cancelModal").modal("hide"));function oe(t){if(t.target.classList.contains("js-serviceModal")){t.preventDefault();let e=t.target.getAttribute("data-id");s.get(`${r}/reverse/${e}`).then(a=>{let o=a.data;o.service==="安親"?ne(o):o.service==="美容"?ce(o):o.service==="住宿"&&le(o)}).catch(a=>{console.log(a)})}}async function D(t,e,a){try{const o=await b(e.userId);t.querySelectorAll(".modalOrderNum").forEach(c=>c.textContent=e.orderNum),t.querySelectorAll(".modalDate").forEach(c=>c.textContent=e.date),t.querySelectorAll(".modalService").forEach(c=>c.textContent=e.service),t.querySelectorAll(".modalName").forEach(c=>c.textContent=o.name),t.querySelectorAll(".modalPhone").forEach(c=>c.textContent=o.phone),t.querySelectorAll(".modalDogName").forEach(c=>c.textContent=e.dogName),t.querySelectorAll(".modalParadise").forEach(c=>c.textContent=e.paradise),t.querySelectorAll(".modalRemark").forEach(c=>c.textContent=e.remark),t.querySelectorAll(".modalEmergencyContact").forEach(c=>c.textContent=e.contact),t.querySelectorAll(".modalEmergencyPhone").forEach(c=>c.textContent=e.phone),a&&a(t,e)}catch(o){console.log(o)}}async function ne(t){D(X,t,(e,a)=>{e.querySelector(".modalTotal").value=a.total})}async function ce(t){D(Z,t,(e,a)=>{e.querySelector(".modalSize").textContent=a.size,e.querySelector(".modalPlan").textContent=a.plan,e.querySelector(".modalTotal").value=a.total})}async function le(t){D(_,t,(e,a)=>{e.querySelector(".modalRoom").textContent=a.room,e.querySelector(".modalStarDate").textContent=a.startDate,e.querySelector(".modalEndDate").textContent=a.endDate,e.querySelector(".modalTotal").value=a.total})}P.addEventListener("click",de);const re=document.querySelector("#allCaseDayCareModal"),se=document.querySelector("#allCaseCosmeticModal"),ie=document.querySelector("#allCaseStayModal");function de(t){if(t.target.classList.contains("js-allCaseModal")){t.preventDefault();let e=t.target.getAttribute("data-id");s.get(`${r}/reverse/${e}`).then(a=>{let o=a.data;o.service==="安親"?ue(o):o.service==="美容"?me(o):o.service==="住宿"&&Ce(o)}).catch(a=>{console.log(a)})}}async function ue(t){D(re,t,(e,a)=>{e.querySelector(".modalTotal").textContent=a.total})}async function me(t){D(se,t,(e,a)=>{e.querySelector(".modalSize").textContent=a.size,e.querySelector(".modalPlan").textContent=a.plan,e.querySelector(".modalTotal").textContent=a.total})}async function Ce(t){D(ie,t,(e,a)=>{e.querySelector(".modalRoom").textContent=a.room,e.querySelector(".modalStarDate").textContent=a.startDate,e.querySelector(".modalEndDate").textContent=a.endDate,e.querySelector(".modalTotal").textContent=a.total})}document.querySelectorAll(".js-searchGroup").forEach(t=>t.addEventListener("click",he));const fe=document.querySelectorAll(".js-inputSearch");function he(t){t.preventDefault();let e=[];fe.forEach(a=>{if(a.value==="")return;let o="";i==="allCase-tab"||i==="openCase-tab"?o=`${r}/reverse`:i==="cancelCase-tab"&&(o=`${r}/cancelCases`),s.get(o).then(c=>{let d=c.data;if(i==="allCase-tab"||i==="cancelCase-tab"?e=d.filter(C=>C.orderNum.match(a.value.trim())):i==="openCase-tab"&&(e=d.filter(l=>l.isChecked===!1).filter(l=>l.orderNum.match(a.value.trim()))),e.length===0){S("未查獲此筆訂單！","請重新確認"),a.value="";return}i==="allCase-tab"?(v(e,document.querySelector(".allCase")),k(e,document.querySelector(".allCase"),document.querySelector(".allCase .pagination"))):i==="openCase-tab"?(v(e,document.querySelector(".openCase")),k(e,document.querySelector(".openCase"),document.querySelector(".openCase .pagination"))):i==="cancelCase-tab"&&(v(e,document.querySelector(".cancelCase")),k(e,document.querySelector(".cancelCase"),document.querySelector(".cancelCase .pagination"))),a.value=""}).catch(c=>{console.log(c)})})}
