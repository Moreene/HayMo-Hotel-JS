import{e as v,j as r,a as I,i as H,s as x}from"./config-095b7d42.js";import s from"https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.1/esm/axios.js";import"./adminLogOut-261065ee.js";$(function(){$.datepicker.regional["zh-TW"]={dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesMin:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],prevText:"上月",nextText:"次月",weekHeader:"週"},$.datepicker.setDefaults($.datepicker.regional["zh-TW"]),$(function(){$(".datepicker").datepicker({beforeShow:function(t,e){e.dpDiv.addClass("custom-datepicker")},dateFormat:"yy-mm-dd",minDate:1,maxDate:"+3M",onSelect:function(t,e){}}),$(".startDate").datepicker({beforeShow:function(t,e){e.dpDiv.addClass("custom-datepicker")},dateFormat:"yy-mm-dd",minDate:1,maxDate:"+3M",onSelect:function(t,e){const a=new Date(t),o=new Date($(".endDate").val());o&&(a>o?(v("入住日期不能大於退房日期！","請重新選擇日期"),$(".startDate").val("")):a.getDate()===o.getDate()&&a.getMonth()===o.getMonth()&&a.getFullYear()===o.getFullYear()&&(v("入住日期不能與退房日期相同！","請重新選擇日期"),$(".startDate").val("")))}}),$(".endDate").datepicker({beforeShow:function(t,e){e.dpDiv.addClass("custom-datepicker")},dateFormat:"yy-mm-dd",minDate:1,maxDate:"+3M",onSelect:function(t,e){const a=new Date(t),o=new Date($(".startDate").val());o&&(o>a?(v("退房日期不能小於入住日期！","請重新選擇日期"),$(".endDate").val("")):o.getDate()===a.getDate()&&o.getMonth()===a.getMonth()&&o.getFullYear()===a.getFullYear()&&(v("入住日期不能與退房日期相同！","請重新選擇日期"),$(".endDate").val("")))}})})});$(".startDate").on("change",function(t){const e=t.target.value;if(e){const a=new Date(e),o=new Date($(".endDate").val());o&&a>o?(v("入住日期不能大於退房日期！","請重新選擇日期"),$(".startDate").val("")):o&&a.getTime()===o.getTime()&&(v("入住日期不能與退房日期相同！","請重新選擇日期"),$(".startDate").val(""))}});$(".endDate").on("change",function(t){const e=t.target.value;if(e){const a=new Date(e),o=new Date($(".startDate").val());o&&o>a?(v("退房日期不能小於入住日期！","請重新選擇日期"),$(".endDate").val("")):o&&o.getTime()===a.getTime()&&(v("入住日期不能與退房日期相同！","請重新選擇日期"),$(".endDate").val(""))}});$(document).ready(function(){$(".timepicker").timepicker({timeFormat:"h:i A",step:60,minTime:"9:00",maxTime:"21:00",startTime:"9:00",dynamic:!0}),$(".timepicker").on("changeTime",function(){$(this).val()})});(function(){var t=document.querySelectorAll(".needs-validation");Array.prototype.slice.call(t).forEach(function(e){e.addEventListener("submit",function(a){e.checkValidity()||(a.preventDefault(),a.stopPropagation()),e.classList.add("was-validated")},!1)})})();const j=10;let S=1,i="allCase-tab";const z=document.querySelector(".js-blacklist"),T=document.querySelector(".js-cancelCaseContent"),P=document.querySelectorAll(".js-serviceSelect"),E=document.querySelector(".js-openCaseContent"),B=document.querySelector(".js-allCaseContent");let h;f("reverse","allCase");document.querySelectorAll(".nav-link").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),i=e.target.closest(".nav-link").getAttribute("id"),P.forEach(a=>{a.value="服務篩選"}),e.target.closest(".js-allCasePill")?f("reverse","allCase"):e.target.closest(".js-openCasePill")?f("reverse","openCase"):e.target.closest(".js-canacelPill")?f("cancelCases","cancelCase"):e.target.closest(".js-blacklistPill")&&f("blacklists","blacklist")})});const O=document.querySelector(".js-blackListNum");function R(){s.get(`${r}/blackLists`).then(t=>{let e=t.data;O.textContent=e.length}).catch(t=>{console.log(t)})}R();function f(t,e){S=1;const a=document.querySelector(`#${e}`),o=a.querySelector(".pagination"),n=t==="reverse";s.get(`${r}/${t}`).then(d=>{let C=d.data;n&&e==="openCase"&&(C=C.filter(l=>l.isChecked===!1)),p(C,a),q(C,a,o)}).catch(d=>{console.log(d)})}async function p(t,e){const a=(S-1)*j,o=a+j,n=t.sort((l,c)=>c.id-l.id).slice(a,o),d=t.sort((l,c)=>new Date(l.date)-new Date(c.date)).slice(a,o),C=t.sort((l,c)=>new Date(c.date)-new Date(l.date)).slice(a,o);if(e){if(e.classList.contains("blacklist")){let l="";n.forEach(c=>{l+=`
                    <tr>
                        <th scope="row" class="fw-normal">${c.name}</th>
                        <td>${c.email}</td>
                        <td>${c.phone}</td>
                        <td>${c.date}</td>
                        <td>${c.reason}</td>
                    </tr>`}),z.innerHTML=l}else if(e.classList.contains("cancelCase")){let l="";for(const c of n){const m=await b(c.userId);l+=`
                    <tr>
                        <th scope="row">
                            <a href="#" data-bs-toggle="modal"
                                data-bs-target="#cancelCaseModal" data-id=${c.id}>${c.orderNum}</a>
                        </th>
                        <td>${c.date}</td>
                        <td>${c.service}</td>
                        <td>${m.name}</td>
                        <td>${m.phone}</td>
                        <td>${c.dogName}</td>
                        <td>${c.paradise}</td>
                    </tr>
                        `}T.innerHTML=l}else if(e.classList.contains("openCase")){let l="";for(const c of d){const m=await b(c.userId);let u="";c.service==="安親"?u="dayCareModal":c.service==="美容"?u="cosmeticModal":c.service==="住宿"&&(u="stayModal"),l+=`
                    <tr>
                        <th scope="row">
                            <a href="#" class="js-serviceModal" data-bs-toggle="modal" data-bs-target="#${u}" data-id=${c.id}>${c.orderNum}</a>
                        </th>
                        <td>${c.date}</td>
                        <td>${c.service}</td>
                        <td>${m.name}</td>
                        <td>${m.phone}</td>
                        <td>${c.dogName}</td>
                        <td>${c.paradise}</td>
                        <td>
                            <div class="d-flex justify-content-center">
                                <input type="checkbox" class="checkbox w-18px h-18px" data-id=${c.id}>
                            </div>
                        </td>
                        <td><a href="#" data-bs-toggle="modal" data-bs-target="#cancelModal" class="link-black-60 js-cancelModal" data-id=${c.id}><i class="bi bi-trash3-fill fs-5"></i></a></td>
                    </tr>
                        `}E.innerHTML=l}else if(e.classList.contains("allCase")){let l="";for(const c of C){const m=await b(c.userId);let u="";c.service==="安親"?u="allCaseDayCareModal":c.service==="美容"?u="allCaseCosmeticModal":c.service==="住宿"&&(u="allCaseStayModal"),l+=`
                    <tr>
                        <th scope="row">
                            <a href="#" class="js-allCaseModal" data-bs-toggle="modal" data-bs-target="#${u}" data-id=${c.id}>${c.orderNum}</a>
                        </th>
                        <td>${c.date}</td>
                        <td>${c.service}</td>
                        <td>${m.name}</td>
                        <td>${m.phone}</td>
                        <td>${c.dogName}</td>
                        <td>${c.paradise}</td>
                        ${c.isChecked?'<td><i class="bi bi-check-lg fs-5"></i></td>':"<td>-</td>"}
                    </tr>
                    `}B.innerHTML=l}}}async function b(t){try{return(await s.get(`${r}/users`)).data.find(o=>o.id===parseInt(t))}catch(e){return console.log(e),null}}function q(t,e,a){const o=Math.ceil(t.length/j),n=a;n.innerHTML="";const d=(c,m)=>{const u=document.createElement("li");u.className="page-item";const k=document.createElement("a");return k.className="page-link",k.href="#",k.textContent=c,k.setAttribute("data-page",c),k.addEventListener("click",m),u.appendChild(k),u},C=d("<",()=>{S>1&&(S--,p(t,e),M(e))});n.appendChild(C);for(let c=1;c<=o;c++){const m=d(c,()=>{S=c,p(t,e),M(e)});n.appendChild(m)}const l=d(">",()=>{S<o&&(S++,p(t,e),M(e))});n.appendChild(l),M(e)}function M(t){document.querySelectorAll(".page-link").forEach(a=>a.classList.remove("active"));const e=t.querySelector(`.page-link[data-page="${S}"]`);e&&e.classList.add("active")}const y=document.querySelector(".blackForm"),V=document.querySelector(".js-blockName"),L=document.querySelector(".js-blockEmail"),w=document.querySelector(".js-blockPhone"),Y=document.querySelector(".js-blockDate"),U=document.querySelector(".js-blockReason");y.addEventListener("submit",W);function W(t){if(t.preventDefault(),y.checkValidity())if(I(L.value.trim()))if(H(w.value.trim()))s.post(`${r}/blackLists`,{name:V.value.trim(),email:L.value.trim(),phone:w.value.trim(),date:Y.value.trim(),reason:U.value.trim()}).then(e=>{x("新增成功!","",3e3),$("#blackListModal").modal("hide"),y.reset(),y.classList.remove("was-validated"),R(),f("blacklists","blacklist")}).catch(e=>{console.log(e)});else{y.querySelector(".js-errorPhone").innerHTML='<i class="bi bi-exclamation-circle me-4"></i> 手機號碼號碼格式錯誤',w.value="";return}else{y.querySelector(".js-errorEmail").innerHTML='<i class="bi bi-exclamation-circle me-4"></i> Email格式錯誤',L.value="";return}else{t.stopPropagation();return}}document.querySelectorAll(".btn-close").forEach(t=>{t.addEventListener("click",()=>{y.reset(),y.classList.remove("was-validated")})});document.querySelector(".js-clearFormBtn").addEventListener("click",()=>{y.reset(),y.classList.remove("was-validated")});const G=document.querySelector(".js-cancelCaseNum");function F(){s.get(`${r}/cancelCases`).then(t=>{let e=t.data;G.textContent=e.length}).catch(t=>{console.log(t)})}F();T.addEventListener("click",J);function J(t){if(t.target.getAttribute("data-bs-toggle")){t.preventDefault();let e=t.target.getAttribute("data-id");s.get(`${r}/cancelCases/${e}`).then(a=>{let o=a.data;K(o)}).catch(a=>{console.log(a)})}}const g=document.querySelector("#cancelCaseModal");async function K(t){try{const e=await b(t.userId);g.querySelector(".modalOrderNum").textContent=t.orderNum,g.querySelector(".modalDate").textContent=t.date,g.querySelector(".modalService").textContent=t.service,g.querySelector(".modalName").textContent=e.name,g.querySelector(".modalPhone").textContent=e.phone,g.querySelector(".modalDogName").textContent=t.dogName,g.querySelector(".modalParadise").textContent=t.paradise,g.querySelector(".modalRemark").textContent=t.remark,g.querySelector(".modalEmergencyContact").textContent=t.contact,g.querySelector(".modalEmergencyPhone").textContent=t.phone}catch(e){console.log(e)}}P.forEach(t=>{t.addEventListener("change",e=>{if(i==="allCase-tab")if(e.target.value==="")f("reverse","allCase");else{const a=e.target.value;A(a,"reverse")}else if(i==="openCase-tab")if(e.target.value==="")f("reverse","openCase");else{const a=e.target.value;A(a,"reverse")}else if(i==="cancelCase-tab")if(e.target.value==="")f("cancelCases","cancelCase");else{const a=e.target.value;A(a,"cancelCases")}})});function A(t,e){h=[],s.get(`${r}/${e}`).then(a=>{let o=a.data;S=1,t==="安親"?h=o.filter(n=>n.service==="安親"):t==="美容"?h=o.filter(n=>n.service==="美容"):t==="住宿"&&(h=o.filter(n=>n.service==="住宿")),i==="cancelCase-tab"?(p(h,document.querySelector(".cancelCase")),q(h,document.querySelector(".cancelCase"),document.querySelector(".cancelCase .pagination"))):i==="openCase-tab"?(p(h,document.querySelector(".openCase")),q(h,document.querySelector(".openCase"),document.querySelector(".openCase .pagination"))):i==="allCase-tab"&&(p(h,document.querySelector(".allCase")),q(h,document.querySelector(".allCase"),document.querySelector(".allCase .pagination")))}).catch(a=>{console.log(a)})}const Q=document.querySelector(".js-openCaseNum");function N(){s.get(`${r}/reverse`).then(t=>{let a=t.data.filter(o=>o.isChecked===!1);Q.textContent=a.length}).catch(t=>{console.log(t)})}N();E.addEventListener("change",ee);E.addEventListener("click",oe);E.addEventListener("click",ae);const X=document.querySelector("#dayCareModal"),Z=document.querySelector("#cosmeticModal"),_=document.querySelector("#stayModal");function ee(t){if(t.target.classList.contains("checkbox")){let e=t.target.getAttribute("data-id");s.get(`${r}/reverse/${e}`).then(a=>{let o=a.data;document.querySelector(".js-checkModalNum").textContent=o.orderNum,document.querySelector(".js-checkBtn").setAttribute("data-id",o.id),$("#checkModal").modal("show")}).catch(a=>{console.log(a)})}}document.querySelector(".js-checkBtn").addEventListener("click",async t=>{let e=t.target.getAttribute("data-id");try{let o=(await s.get(`${r}/reverse/${e}`)).data;o.isChecked=!0,await s.patch(`${r}/reverse/${e}`,o),x("已結案！","",3e3),N(),f("reverse","openCase"),$("#checkModal").modal("hide")}catch(a){console.log(a)}});document.querySelector(".js-nocheckBtn").addEventListener("click",()=>{$("#checkModal").modal("hide"),document.querySelectorAll(".checkbox").forEach(t=>t.checked=!1)});const te=document.querySelector("#checkModal");te.addEventListener("click",t=>{t.target.classList.contains("btn-close")&&document.querySelectorAll(".checkbox").forEach(e=>e.checked=!1)});function ae(t){if(t.target.closest(".js-cancelModal")){t.preventDefault();let e=t.target.closest(".js-cancelModal").getAttribute("data-id");s.get(`${r}/reverse/${e}`).then(a=>{let o=a.data;document.querySelector(".js-cancelModalNum").textContent=o.orderNum,document.querySelector(".js-cancelBtn").setAttribute("data-id",o.id)}).catch(a=>{console.log(a)})}}document.querySelector(".js-cancelBtn").addEventListener("click",async t=>{let e=t.target.getAttribute("data-id");try{const o=(await s.get(`${r}/reverse/${e}`)).data,d=(await s.get(`${r}/cancelCases`)).data.length+1;o.id=d,await s.post(`${r}/cancelCases`,o),await s.delete(`${r}/reverse/${e}`),x("取消成功！","",3e3),f("reverse","openCase"),N(),F(),$("#cancelModal").modal("hide")}catch(a){console.log(a)}});document.querySelector(".js-noCancelBtn").addEventListener("click",()=>$("#cancelModal").modal("hide"));function oe(t){if(t.target.classList.contains("js-serviceModal")){t.preventDefault();let e=t.target.getAttribute("data-id");s.get(`${r}/reverse/${e}`).then(a=>{let o=a.data;o.service==="安親"?ce(o):o.service==="美容"?ne(o):o.service==="住宿"&&le(o)}).catch(a=>{console.log(a)})}}async function D(t,e,a){try{const o=await b(e.userId);t.querySelectorAll(".modalOrderNum").forEach(n=>n.textContent=e.orderNum),t.querySelectorAll(".modalDate").forEach(n=>n.textContent=e.date),t.querySelectorAll(".modalService").forEach(n=>n.textContent=e.service),t.querySelectorAll(".modalName").forEach(n=>n.textContent=o.name),t.querySelectorAll(".modalPhone").forEach(n=>n.textContent=o.phone),t.querySelectorAll(".modalDogName").forEach(n=>n.textContent=e.dogName),t.querySelectorAll(".modalParadise").forEach(n=>n.textContent=e.paradise),t.querySelectorAll(".modalRemark").forEach(n=>n.textContent=e.remark),t.querySelectorAll(".modalEmergencyContact").forEach(n=>n.textContent=e.contact),t.querySelectorAll(".modalEmergencyPhone").forEach(n=>n.textContent=e.phone),t.querySelectorAll(".js-storeBtn").forEach(n=>n.setAttribute("data-id",e.id)),a&&a(t,e)}catch(o){console.log(o)}}async function ce(t){D(X,t,(e,a)=>{e.querySelector(".modalTotal").value=a.total})}async function ne(t){D(Z,t,(e,a)=>{e.querySelector(".modalSize").textContent=a.size,e.querySelector(".modalPlan").textContent=a.plan,e.querySelector(".modalTotal").value=a.total})}async function le(t){D(_,t,(e,a)=>{e.querySelector(".modalRoom").textContent=a.room,e.querySelector(".modalStarDate").textContent=a.startDate,e.querySelector(".modalEndDate").textContent=a.endDate,e.querySelector(".modalTotal").value=a.total})}document.querySelectorAll(".js-storeBtn").forEach(t=>{t.addEventListener("click",re)});function re(t){let e=t.target.getAttribute("data-id"),a=t.target.closest(".modal").querySelector(".modalTotal");if(a.value===""){v("請輸入訂單金額！");return}s.patch(`http://localhost:3000/reverse/${e}`,{total:a.value}).then(o=>{x("儲存成功！","",3e3)}).catch(o=>{console.log(o)})}B.addEventListener("click",ue);const se=document.querySelector("#allCaseDayCareModal"),ie=document.querySelector("#allCaseCosmeticModal"),de=document.querySelector("#allCaseStayModal");function ue(t){if(t.target.classList.contains("js-allCaseModal")){t.preventDefault();let e=t.target.getAttribute("data-id");s.get(`${r}/reverse/${e}`).then(a=>{let o=a.data;o.service==="安親"?me(o):o.service==="美容"?Ce(o):o.service==="住宿"&&fe(o)}).catch(a=>{console.log(a)})}}async function me(t){D(se,t,(e,a)=>{e.querySelector(".modalTotal").textContent=a.total})}async function Ce(t){D(ie,t,(e,a)=>{e.querySelector(".modalSize").textContent=a.size,e.querySelector(".modalPlan").textContent=a.plan,e.querySelector(".modalTotal").textContent=a.total})}async function fe(t){D(de,t,(e,a)=>{e.querySelector(".modalRoom").textContent=a.room,e.querySelector(".modalStarDate").textContent=a.startDate,e.querySelector(".modalEndDate").textContent=a.endDate,e.querySelector(".modalTotal").textContent=a.total})}document.querySelectorAll(".js-searchGroup").forEach(t=>t.addEventListener("click",ge));const he=document.querySelectorAll(".js-inputSearch");function ge(t){t.preventDefault();let e=[];he.forEach(a=>{if(a.value==="")return;let o="";i==="allCase-tab"||i==="openCase-tab"?o=`${r}/reverse`:i==="cancelCase-tab"&&(o=`${r}/cancelCases`),s.get(o).then(n=>{let d=n.data;if(i==="allCase-tab"||i==="cancelCase-tab"?e=d.filter(C=>C.orderNum.match(a.value.trim())):i==="openCase-tab"&&(e=d.filter(l=>l.isChecked===!1).filter(l=>l.orderNum.match(a.value.trim()))),e.length===0){v("未查獲此筆訂單！","請重新確認"),a.value="";return}i==="allCase-tab"?(p(e,document.querySelector(".allCase")),q(e,document.querySelector(".allCase"),document.querySelector(".allCase .pagination"))):i==="openCase-tab"?(p(e,document.querySelector(".openCase")),q(e,document.querySelector(".openCase"),document.querySelector(".openCase .pagination"))):i==="cancelCase-tab"&&(p(e,document.querySelector(".cancelCase")),q(e,document.querySelector(".cancelCase"),document.querySelector(".cancelCase .pagination"))),a.value=""}).catch(n=>{console.log(n)})})}
